---
title: "Benchmark"
author: "Micha≈Ç Burdukiewicz"
date: "23 07 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(dplyr)
library(ggplot2)

package_colors <- c(ape = "#66c2a5", Biostrings = "#fc8d62", 
            tidysq = "#8da0cb", seqinr = "#e78ac3")

melt_res <- read.csv("results.csv") %>% 
  group_by(package, sq_len, num_sq, type, file_size) %>% 
  summarise(obj_size = median(obj_size),
            time_value = median(time_value)) %>% 
  ungroup() %>% 
  mutate(num_sq = factor(num_sq, levels = sort(unique(num_sq)),
                         labels = paste0("Number of sequences:\n", sort(unique(num_sq)))))

```

Software compared:

 - seqinr: the oldest (check it!) **R** package for sequence analysis.
 - ape: the main CRAN package for sequence analysis, especially phylogeny. Parts of the code is compiled and the pre-compiled version is unavailable.
 - Biostrings: the Bioconductor staple package for sequence analysis. 

We include seqinr only due to its sheer popularity as in all aspects it is less efficient than any other tool.

## Object size

### read_fasta and analogues

Thanks to the bit-wise encoding, **sq** objects are the smallest - even smaller than files on the hard drive.

Black triangles denotes object size on the hard drive.

```{r,fig.height=10}
# ggplot(melt_res, aes(x = sq_len, y = obj_size, color = type)) +
#   geom_point() +
#   geom_line() +
#   facet_grid(package ~ num_sq, labeller = label_both)
# what biostrings are doing?

filter(melt_res, type == "read") %>% 
  ggplot(aes(x = sq_len, y = obj_size, color = package)) +
  geom_point(aes(y = file_size, shape = "File size"), color = "black", size = 4, shape = 17) +
  geom_point() +
  geom_line() +
  geom_line(aes(y = file_size), color = "black", linetype = "dashed") +
  facet_grid(num_sq ~ package) +
  scale_color_manual(values = package_colors) +
  scale_y_continuous("Size") +
  scale_x_continuous("Average sequence length") +
  scale_shape_manual(name = "Sex", breaks = c("File size"), values = 16) +
  ggtitle("read_fasta output size") +
  theme_bw() +
  theme(legend.position = "bottom")
```

Without seqinr.

```{r,fig.height=10}
filter(melt_res, type == "read", package != "seqinr") %>% 
  ggplot(aes(x = sq_len, y = obj_size, color = package)) +
  geom_point(aes(y = file_size, shape = "File size"), color = "black", size = 4, shape = 17) +
  geom_point() +
  geom_line() +
  geom_line(aes(y = file_size), color = "black", linetype = "dashed") +
  facet_grid(num_sq ~ package) +
  scale_color_manual(values = package_colors) +
  scale_y_continuous("Size") +
  scale_x_continuous("Average sequence length") +
  scale_shape_manual(name = "Sex", breaks = c("File size"), values = 16) +
  ggtitle("read_fasta output size") +
  theme_bw() +
  theme(legend.position = "bottom")

```


## Speed

```{r}
filter(melt_res, type == "read") %>% 
  ggplot(aes(x = sq_len, y = time_value, color = package)) +
  geom_point() +
  geom_line() +
  facet_wrap( ~ num_sq, scales = "free_y") +
  scale_color_manual(values = package_colors) +
  ggtitle("read_fasta time") +
  theme_bw() +
  theme(legend.position = "bottom")

```

Without seqinr.

```{r}
filter(melt_res, type == "read", package != "seqinr") %>% 
  ggplot(aes(x = sq_len, y = time_value, color = package)) +
  geom_point() +
  geom_line() +
  facet_wrap( ~ num_sq, scales = "free_y") +
  scale_color_manual(values = package_colors) +
  ggtitle("read_fasta time") +
  theme_bw() +
  theme(legend.position = "bottom")

```

```{r}
filter(melt_res, type == "char") %>% 
  ggplot(aes(x = sq_len, y = time_value, color = package)) +
  geom_point() +
  geom_line() +
  facet_wrap( ~ num_sq, labeller = label_both, scales = "free_y") +
  ggtitle("as.character time") +
  theme_bw() +
  theme(legend.position = "bottom")
```


```{r}
filter(melt_res, type == "cons") %>% 
  ggplot(aes(x = sq_len, y = time_value, color = package)) +
  geom_point() +
  geom_line() +
  facet_wrap( ~ num_sq, labeller = label_both, scales = "free_y") +
  ggtitle("from character to class time") +
  theme_bw() +
  theme(legend.position = "bottom")
```

### Only tidysq and Biostrings

```{r}
filter(melt_res, type == "cons") %>% 
  filter(package %in% c("Biostrings", "tidysq")) %>% 
  ggplot(aes(x = sq_len, y = time_value, color = package)) +
  geom_point() +
  geom_line() +
  facet_wrap( ~ num_sq, labeller = label_both, scales = "free_y") +
  ggtitle("from character to class time") +
  theme_bw() +
  theme(legend.position = "bottom")
```
